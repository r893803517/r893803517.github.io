#### 一、格式检查、明确协议

浏览器对用户输入的url做初步的格式化检查

完整的URL是由**协议**（比如http，ftp）、**域名**（比如*http://www.baidu.com*）、**文件路径**（比如/htm_data/20/1510/1441477.html这样的）和**端口**（比如:80）四个部分组成的

#### 二、DNS查询

1. 浏览器有DNS缓存会先进行查找 

2. 搜索操作系统自身的DNS缓存

3. 查找本地hosts文件

4. 路由器缓存

5. ISP DNS缓存   ISP DNS 就是在客户端电脑上设置的首选 DNS 服务器，它们在大多数情况下都会有缓存。

6. 向**根域名服务器**发送查找请求、DNS服务器保存了WEB服务器域名与IP的映射关系
   
   ![dns-server](.\img\dns-server.png)

#### 三、TCP连接

TCP/IP 分为四层，在发送数据时，每层都要对数据进行封装：

![send-request](.\img\send-request.png)

###### 1. 应用层：发送 HTTP 请求

　　在前面的步骤我们已经得到服务器的 IP 地址，浏览器会开始构造一个 HTTP 报文，其中包括：

- 请求报头（Request Header）：请求方法、目标地址、遵循的协议等等
- 请求主体（其他参数）

　　其中需要注意的点：

- 浏览器只能发送 GET、POST 方法，而打开网页使用的是 GET 方法

###### 2. 传输层：TCP 传输报文

　　传输层会发起一条到达服务器的 TCP 连接，为了方便传输，会对数据进行分割（以报文段为单位），并标记编号，方便服务器接受时能够准确地还原报文信息。

　　在建立连接前，会先进行 TCP 三次握手。

> “
> 
> 关于 TCP/IP 三次握手，网上已经有很多段子和图片生动地描述了。
> 
> 相关知识点：
> 
> 1. SYN 泛洪攻击
> 
> ”

###### 3. 网络层：IP协议查询Mac地址

　　将数据段打包，并加入源及目标的IP地址，并且负责寻找传输路线。

　　判断目标地址是否与当前地址处于同一网络中，是的话直接根据 Mac 地址发送，否则使用路由表查找下一跳地址，以及使用 ARP 协议查询它的 Mac 地址。

> “
> 
> 注意：在 OSI 参考模型中 ARP 协议位于链路层，但在 TCP/IP 中，它位于网络层。
> 
> ”

###### 4. 链路层：以太网协议

　**以太网协议**

　根据以太网协议将数据分为以“帧”为单位的数据包，每一帧分为两个部分：

- 标头：数据包的发送者、接受者、数据类型
- 数据：数据包具体内容

　**Mac 地址**

​    以太网规定了连入网络的所有设备都必须具备“网卡”接口，数据包都是从一块网卡传递到另一块网卡，网卡的地址就是 Mac 地址。每一个 Mac 地址都是独一无二的，具备了一对一的能力。

　**广播**

　发送数据的方法很原始，直接把数据通过 ARP 协议，向本网络的所有机器发送，接收方根据标头信息与自身 Mac 地址比较，一致就接受，否则丢弃。

​    **注意**：接收方回应是单播。

> 相关知识点：
> 
> 1. ARP 攻击

#### 

#### 四、处理请求

接受过程就是把以上步骤逆转过来，参见上图。

![process-request](.\img\process-request.png)

#### 五、接收响应

浏览器接收到来自服务器的响应资源后，会对资源进行分析。

1. 首先查看 Response header，根据不同状态码做不同的事（比如上面提到的重定向）。
2. 如果响应资源进行了压缩（比如 gzip），还需要进行解压。
3. 然后，对响应资源做缓存。
4. 接下来，根据响应资源里的 MIME[3] 类型去解析响应内容（比如 HTML、Image各有不同的解析方式）。

#### 六、渲染页面
